<?php

Use Drupal\views\ViewExecutable;
Use Drupal\Core\Form\FormStateInterface;
/**
 * @file
 * Module file for Producer Operation Data Systems (PODS)
 */

/**
 * Implements hook_entity_type_alter().
 */
function cig_pods_entity_type_alter(array &$entity_types) {
  /** @var \Drupal\Core\Entity\EntityTypeInterface[] $entity_types */

  // Override the access handler for asset entities.
  $entity_types['asset']->setAccessClass('Drupal\cig_pods\ProjectAccessControlHandler');
}

/**
 * Implements hook_page_attachments().
 */
function cig_pods_page_attachments(array &$attachments) {
  $attachments['#attached']['library'][] = 'cig_pods/hide_return';
}

/**
 * Implements hook_views_pre_render().
 */
function cig_pods_views_pre_render(ViewExecutable $view ) {

  // Attach custom CSS libraries to PODS Asset List Views.
  if ($view->id() == 'pods_asset_lists') {
    $library = FALSE;
    switch ($view->current_display) {

      // Apply admin_details_display library.
      case 'awardee':
      case 'lab_testing_profile':
      case 'producer':
      case 'soil_health_management_unit':
        $library = 'admin_details_display';
        break;

      // Apply admin_project_display library.
      case 'irrigation':
      $library = 'irrigation_display';
        break;
      case 'pasture_assessment':
      case 'project':
        $library = 'admin_project_display';
        break;

      // Apply misc libraries...
      case 'field_assessment':
        $library = 'field_assessment';
        break;
      case 'lab_result':
        $library = 'awardee_lab_results_display';
        break;
      case 'lab_testing_method':
        $library = 'awardee_methods_details_display';
        break;
      case 'operation':
        $library = 'operation_display';
        break;
      case 'pasture_health_assessment':
        $library = 'pasture_health_display';
        break;
      case 'range_assessment':
        $library = 'range_assessment_display';
        break;
      case 'soil_health_sample':
        $library = 'awardee_soil_sample_display';
        break;
    }
    if ($library) {
      $view->element['#attached']['library'][] = 'cig_pods/' . $library;
    }
  }
}
